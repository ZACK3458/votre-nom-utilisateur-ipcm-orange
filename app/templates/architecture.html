{% extends 'base.html' %}
{% block title %}Architecture{% endblock %}
{% block content %}
<div class="container animate__animated animate__fadeIn">
  <div class="card glass p-3 mb-3">
    <h2 class="mb-0"><i class="bi bi-diagram-3"></i> Architecture Réseau</h2>
    <small class="text-muted">Topologie illustrative (placeholder offline)</small>
  </div>
  <div class="card glass p-3">
    <div class="row g-4">
      <div class="col-12 col-lg-9">
        <div class="p-2 bg-white rounded-4">
          <svg id="topologySvg" viewBox="0 0 800 420" width="100%" height="420" role="img" aria-label="Topologie réseau simplifiée">
            <!-- Links -->
            <defs>
              <marker id="arrow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
                <path d="M 0 0 L 10 5 L 0 10 z" fill="#ff7900" />
              </marker>
            </defs>
            <g id="layer-L2" stroke="#ff7900" stroke-width="2" marker-end="url(#arrow)" opacity="0.85">
              <title>L2</title>
              <line class="link" x1="120" y1="210" x2="300" y2="210"/>
              <line class="link" x1="500" y1="210" x2="680" y2="210"/>
            </g>
            <g id="layer-L3" stroke="#ff7900" stroke-width="2" marker-end="url(#arrow)" opacity="0.85">
              <title>L3</title>
              <line class="link" x1="120" y1="210" x2="300" y2="120"/>
              <line class="link" x1="120" y1="210" x2="300" y2="300"/>
            </g>
            <g id="layer-MPLS" stroke="#ff7900" stroke-width="2" marker-end="url(#arrow)" opacity="0.85">
              <title>MPLS</title>
              <line class="link" x1="500" y1="120" x2="680" y2="120"/>
              <line class="link" x1="500" y1="300" x2="680" y2="300"/>
            </g>
            <!-- Nodes -->
            <g class="nodes">
              <!-- Core Router -->
              <rect class="node" x="70" y="180" rx="16" ry="16" width="100" height="60" fill="#fff3e0" stroke="#ff7900"/>
              <text x="120" y="215" text-anchor="middle" fill="#ff7900" font-weight="700">Core</text>
              <!-- Aggregation -->
              <rect class="node" x="300" y="90" rx="16" ry="16" width="120" height="60" fill="#fff" stroke="#ff7900"/>
              <text x="360" y="125" text-anchor="middle">Agg-North</text>
              <rect class="node" x="300" y="180" rx="16" ry="16" width="120" height="60" fill="#fff" stroke="#ff7900"/>
              <text x="360" y="215" text-anchor="middle">Agg-Central</text>
              <rect class="node" x="300" y="270" rx="16" ry="16" width="120" height="60" fill="#fff" stroke="#ff7900"/>
              <text x="360" y="305" text-anchor="middle">Agg-South</text>
              <!-- Access -->
              <rect class="node" x="680" y="90" rx="16" ry="16" width="110" height="60" fill="#fff" stroke="#ff7900"/>
              <text x="735" y="125" text-anchor="middle">Site A</text>
              <rect class="node" x="680" y="180" rx="16" ry="16" width="110" height="60" fill="#fff" stroke="#ff7900"/>
              <text x="735" y="215" text-anchor="middle">Site B</text>
              <rect class="node" x="680" y="270" rx="16" ry="16" width="110" height="60" fill="#fff" stroke="#ff7900"/>
              <text x="735" y="305" text-anchor="middle">Site C</text>
            </g>
          </svg>
        </div>
      </div>
      <div class="col-12 col-lg-3">
        <div class="glass p-3 h-100">
          <h6 class="fw-bold"><i class="bi bi-info-circle"></i> Légende</h6>
          <ul class="list-unstyled small">
            <li><span class="badge bg-orange">Orange</span> Liaisons actives</li>
            <li><span class="badge bg-secondary">Gris</span> Modules/Nœuds</li>
          </ul>
          <h6 class="fw-bold mt-3"><i class="bi bi-filter"></i> Couches</h6>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="layerL2" checked>
            <label class="form-check-label" for="layerL2">L2</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="layerL3" checked>
            <label class="form-check-label" for="layerL3">L3</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" id="layerMPLS" checked>
            <label class="form-check-label" for="layerMPLS">MPLS</label>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% block scripts %}
<script>
(function(){
  var svg = document.getElementById('topologySvg'); if (!svg) return;
  function toggleLayer(id, visible){
    var g = document.getElementById('layer-' + id);
    if (g) g.style.display = visible ? '' : 'none';
  }
  function bind(id, checkboxId){
    var cb = document.getElementById(checkboxId);
    if (!cb) return; toggleLayer(id, cb.checked);
    cb.addEventListener('change', function(){ toggleLayer(id, cb.checked); });
  }
  bind('L2', 'layerL2');
  bind('L3', 'layerL3');
  bind('MPLS', 'layerMPLS');

  // Hover highlight for nodes and links
  function addHL(sel){
    svg.querySelectorAll(sel).forEach(function(el){
      el.addEventListener('mouseenter', function(){ el.setAttribute('filter','brightness(1.1)'); el.style.strokeWidth = '3'; });
      el.addEventListener('mouseleave', function(){ el.removeAttribute('filter'); el.style.strokeWidth = ''; });
    });
  }
  addHL('.link');
  addHL('.node');
})();
</script>
{% endblock %}
{% endblock %}