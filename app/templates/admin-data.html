{% extends 'base.html' %}
{% block title %}Données administratives{% endblock %}
{% block content %}
<div class="container animate__animated animate__fadeIn">
  <div class="card glass p-4 mb-3">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2">
      <div>
        <h2 class="mb-0"><i class="bi bi-database-lock"></i> Données administratives</h2>
        <small class="text-muted">Gestion et visualisation des jeux de données</small>
      </div>
      <div class="d-flex gap-2">
        <input id="admSearch" type="search" class="form-control" placeholder="Rechercher (nom, type)">
        <select id="admType" class="form-select">
          <option value="">Tous</option>
          <option value="users">Utilisateurs</option>
          <option value="logs">Logs</option>
        </select>
        <button id="admReset" class="btn btn-outline-orange" title="Réinitialiser"><i class="bi bi-arrow-counterclockwise"></i></button>
        <button id="admExport" class="btn btn-outline-orange"><i class="bi bi-download"></i> Export CSV</button>
      </div>
    </div>
  </div>

  <div class="card glass p-0">
    <div class="table-responsive p-3">
      <table id="admTable" class="table align-middle">
        <thead>
          <tr>
            <th scope="col" data-sort="name" aria-sort="none">Nom <i class="bi bi-arrow-down-up small opacity-50"></i></th>
            <th scope="col" data-sort="type" aria-sort="none">Type <i class="bi bi-arrow-down-up small opacity-50"></i></th>
            <th scope="col" data-sort="items" aria-sort="none">Eléments <i class="bi bi-arrow-down-up small opacity-50"></i></th>
            <th scope="col" data-sort="updated" aria-sort="none">MàJ <i class="bi bi-arrow-down-up small opacity-50"></i></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><i class="bi bi-person-badge text-orange"></i> Utilisateurs</td>
            <td><span class="badge bg-primary">users</span></td>
            <td><span class="num">2</span></td>
            <td>Aujourd’hui</td>
          </tr>
          <tr>
            <td><i class="bi bi-journal-text text-orange"></i> Journal d’activité</td>
            <td><span class="badge bg-danger">logs</span></td>
            <td><span class="num">1345</span></td>
            <td>Hier</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script>
  (function enhanceAdmin(){
    var table = document.getElementById('admTable'); if (!table) return;
    var tbody = table.querySelector('tbody'); var rows = Array.from(tbody.querySelectorAll('tr'));
    var search = document.getElementById('admSearch'); var type = document.getElementById('admType');
    var resetBtn = document.getElementById('admReset'); var exportBtn = document.getElementById('admExport');
    function norm(t){ return (t||'').toString().toLowerCase(); }
    function apply(){ var q = norm(search && search.value); var ty = (type && type.value)||'';
      rows.forEach(function(tr){ var name = norm(tr.children[0].textContent); var ttype = norm(tr.children[1].textContent);
        var show = (!q || name.includes(q)) && (!ty || ttype.includes(ty)); tr.style.display = show? '' : 'none'; }); }
    if (search) search.addEventListener('input', apply); if (type) type.addEventListener('change', apply); apply();
    var sortDir={}; table.querySelectorAll('thead th[data-sort]').forEach(function(th){ th.style.cursor='pointer'; th.addEventListener('click',function(){
      var key=th.getAttribute('data-sort'); sortDir[key]=sortDir[key]==='asc'?'desc':'asc'; var dir=sortDir[key];
      table.querySelectorAll('thead th[data-sort]').forEach(function(oth){oth.setAttribute('aria-sort','none');}); th.setAttribute('aria-sort',dir);
      rows.sort(function(a,b){ function val(tr){ if(key==='name')return tr.children[0].textContent.trim(); if(key==='type')return tr.children[1].textContent.trim(); if(key==='items')return parseFloat(tr.children[2].querySelector('.num').textContent)||0; if(key==='updated')return tr.children[3].textContent.trim(); return ''; }
        var va=val(a), vb=val(b); if(typeof va==='number'&&typeof vb==='number')return dir==='asc'?va-vb:vb-va; return dir==='asc'?String(va).localeCompare(String(vb)):String(vb).localeCompare(String(va)); });
      rows.forEach(function(tr){ tbody.appendChild(tr); }); }); });
    function toCSV(t){ return '"'+t.replace(/"/g,'""')+'"'; }
    function exportCSV(){ var lines=[]; var headers=Array.from(table.querySelectorAll('thead th')).map(function(th){return th.textContent.trim();}); lines.push(headers.join(',')); rows.forEach(function(tr){ if(tr.style.display==='none')return; var cells=Array.from(tr.children).map(function(td,i){ if(i===2){var n=td.querySelector('.num'); return n?n.textContent.trim():td.textContent.trim();} return td.textContent.trim();}); lines.push(cells.map(toCSV).join(','));}); var blob=new Blob([lines.join('\n')],{type:'text/csv;charset=utf-8;'}); var url=URL.createObjectURL(blob); var a=document.createElement('a'); a.href=url; a.download='admin-data.csv'; a.click(); setTimeout(function(){URL.revokeObjectURL(url);},1000);} 
    if (resetBtn) resetBtn.addEventListener('click', function(e){ e.preventDefault(); if (search) search.value=''; if (type) type.value=''; apply(); }); if (exportBtn) exportBtn.addEventListener('click', exportCSV);
  })();
</script>
{% endblock %}